# 5.4. `MessageResponse` (REST DTO)

`MessageResponse` is a simple immutable Data Transfer Object (DTO) used for **returning chat messages to REST API 
clients.**

It represents the **public API form** of the `Message` JPA entity.

```java
package com.chatapp.chat.chat.message;

import java.time.Instant;
import java.util.UUID;

public record MessageResponse(
        UUID id,
        String chatId,
        String sender,
        String content,
        Instant createdAt
) {
    public static MessageResponse fromEntity(Message m) {
        return new MessageResponse(
                m.getId(),
                m.getChatId(),
                m.getSender(),
                m.getContent(),
                m.getCreatedAt()
        );
    }
}
```

---

## üìù Purpose
`MessageResponse` is used by the `MessageController` to:
- return a list of messages for a chat room
- expose only safe and necessary fields
- convert JPA entities into a lightweight REST-safe format

This ensures:
- controllers do *not* expose JPA internals
- fields remain immutable
- responses are consistent and predictable

---

## Why a `record`?

Using Java `record` provides:
- immutability
- concise syntax
- built-in `equals`, `hashCode`, `toString`
- ideal for DTOs meant for serialization

---

## üìå Field Description

| Column      | Type    | Description                                               |
|:------------|:--------|-----------------------------------------------------------|
| `id`        | UUID    | Unique identifier of the message.                         |
| `chatId`    | String  | The chat room identifier the message belongs to.          |
| `sender`    | String  | Username of the message author.                           |
| `content`   | String  | The actual text of the chat message.                      |
| `createdAt` | Instant | Timestamp of message creation, generated by the database. |

---

## üîÑ `fromEntity()` Factory Method

```java
public static MessageResponse fromEntity(Message message)
```

This method converts a persisted `Message` entity into a serializable DTO.

Why use a static factory method?
- centralizes the mapping logic
- prevents field mismatches
- simplifies controller logic
- keeps entities independent of REST API design

Used by:

```java
messageService.getChatHistory(chatId)
        .stream()
        .map(MessageResponse::fromEntity)
        .toList();
```

## üì§ Example JSON Returned by the REST API
```json
{
  "id": "21c3b3c0-9a54-49f5-912e-55d38ed8f33e",
  "chatId": "room-42",
  "sender": "alice",
  "content": "Hello there!",
  "createdAt": "2026-02-01T14:12:22.401Z"
}

```

---

## ‚úî Summary
`MessageResponse` is the REST-facing representation of the `Message` entity.

Key characteristics:
- Immutable
- Safe for serialization
- Separates internal JPA model from external API
- Provides a clean, consistent API contract
- Supports easy mapping via `fromEntity`

It is a foundational part of the message retrieval flow in:
- `MessageService`
- `MessageController`

---
