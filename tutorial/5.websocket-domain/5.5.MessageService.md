# âœ… 5.5. MessageService

`MessageService` is the primary service layer responsible for **storing** and **retrieving chat messages** from the 
persistence layer.

It acts as a boundary between the REST/WebSocket controllers and the JPA repository.

```java
package com.chatapp.chat.chat.message;

import lombok.RequiredArgsConstructor;
import org.springframework.stereotype.Service;

import java.util.List;

@Service
@RequiredArgsConstructor
public class MessageService {

    private final MessageRepository messageRepository;

    public Message save(Message message) {
        return messageRepository.save(message);
    }

    public List<Message> getChatHistory(String chatId) {
        return messageRepository.findAllByChatIdOrderByCreatedAtAsc(chatId);
    }
}
```

--- 

## ğŸ“Œ Responsibilities

### âœ” 1. Persisting messages

The service stores newly created chat messages coming from:
- WebSocket endpoint (`ChatController#sendMessage`)
- (Possible future REST endpoints for message creation)

It uses `MessageRepository.save()` to write the message to the database.

### âœ” 2. Returning message history

`getChatHistory(chatId)` returns all messages in chronological order for a specific chat room.

Used by:
- `MessageController` (REST endpoint `/api/messages/{chatId}`)

--- 

## ğŸ“Œ Why this service exists?

Even though it is currently a thin layer, it provides:

### 1ï¸âƒ£ Separation of concerns

Controllers should not access repositories directly â€” each domain requires its own service layer.

### 2ï¸âƒ£ Isolation from repository changes

If the underlying persistence logic changes, controllers remain unaffected.

### 3ï¸âƒ£ Future expansion point

This service will be expanded as the messaging domain grows.

Examples of future responsibilities include:
- message validation
- access control (membership checking)
- mapping entities to DTOs
- event publishing (WebSocket)
- transactional operations
- moderation/filtering rules
- message editing/deleting features

---

## ğŸ“Œ Method Breakdown

### `save(Message message)`

Stores the given `Message` entity.

### Returns:
`Message` â€” the persisted entity (with ID & timestamp populated)

### `getChatHistory(String chatId)`

Fetches all messages for a given chat, ordered ascending by creation time.

Uses repository query:

```java
findAllByChatIdOrderByCreatedAtAsc(String chatId)
```

---

## ğŸ“¤ Example usage in ChatController

```java
Message saved = messageService.save(
    Message.builder()
        .chatId(message.getChatId())
        .sender(message.getSender())
        .content(message.getContent())
        .build()
);
```

---

## ğŸ“Œ Current Limitations

The current implementation does **not**:
- validate chat membership
- validate input
- map to DTOs
- handle exceptions
- enforce access control
- wrap operations in transactions

This is acceptable for MVP but expected to evolve.

---

## âœ” Summary

`MessageService` is a lightweight service layer for the messaging domain, responsible for:
- storing messages
- retrieving message history
- decoupling controllers from persistence logic

Although currently minimal, it forms a foundation for future domain logic such as validation, permissions, events, and 
richer chat features.
