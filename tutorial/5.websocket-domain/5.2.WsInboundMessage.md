# 5.2. `WsInboundMessage`

`WsInboundMessage` is a **WebSocket DTO** that represents messages incoming *from the frontend to the backend* in the 
STOMP WebSocket flow.

This object is **not persisted**.  
It exists only during real-time communication and is later transformed into:
- a persisted `Message` entity (for `CHAT` events)
- a `WsOutboundMessage` (for broadcasting back to all subscribers)

```java
package com.chatapp.chat.chat;

import com.chatapp.chat.chat.ws.WsMessageType;
import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
public class WsInboundMessage {

    private String chatId;
    private String sender;
    private String content;
    private WsMessageType type;

}
```

---

## ğŸ“ Purpose

`WsInboundMessage` is used as the **incoming payload** for WebSocket endpoints such as:

- `/app/chat.sendMessage`
- `/app/chat.addUser`

These endpoints are handled inside `WsChatController`.

It represents a **live WebSocket event**, not a stored database message.  
Persistence is handled separately by the JPA entity `Message`.

This DTO is paired with `WsOutboundMessage`, which is used to broadcast processed messages to clients.

--- 

## ğŸ“Œ Fields Explained

### `chatId`

Identifies the chat room to which the message belongs.

Used to:
- determine which topic (`/topic/chat.{chatId}) the message should be broadcast to
- match the message to a specific conversation

---

### `sender`

The username (or user identifier) of the user sending the message.

Used by the frontend to:
- message author name
- system events for JOIN/LEAVE

---

### `content`

The raw text content of the message.

Only used when `type == CHAT`.
<br>
Ignored for system messages such as JOIN or LEAVE.

--- 

### `type`

A value from the `WsMessageType` enum:
- `CHAT` - normal user message
- `JOIN` - user joined
- `LEAVE`- user left

Determines how the backend processes the message and how the frontend should display it.

--- 

## ğŸ“¡ Example JSON Payload

### Sent by frontend:

### Example: chat message sent from frontend
```json
{
  "chatId": "room123",
  "sender": "Alice",
  "content": "Hello!",
  "type": "CHAT"
}
```

### Example: join event sent to backend
```json
{
  "chatId": "room123",
  "sender": "bob",
  "type": "JOIN"
}
```

---

## ğŸ”„ Backend Flow

### **In `WsChatController.sendMessage()`**
1. Receives `WsInboundMessage`
2. Converts to a `Message` JPA entity
3. Saves to database (`MessageService.save`)
4. Converts to `WsOutboundMessage`
5. Broadcasts to `/topic/chat.{chatId}`

### **In `WsChatController.addUser()`**
1. Forced `type = JOIN`
2. Converted to `WsOutboundMessage`
3. Broadcasts to subscribers

---

## ğŸ— Why This DTO Matters

### âœ” **Clear separation of responsibilities**
- `WsInboundMessage` â†’ incoming WebSocket command
- `Message` â†’ database entity
- `WsOutboundMessage` â†’ outgoing broadcast

### âœ” **Consistent WebSocket protocol**
Frontend always receives and sends messages in predictable JSON format.

### âœ” **Extendable**
Future additions may include:
- timestamps
- avatars
- message metadata
- delivery/read receipts
- typing indicators

### âœ” **Lightweight, frontend-friendly structure**

---

## âœ” Summary

`WsInboundMessage` is the **incoming WebSocket message model** and forms the entry point into the chat processing flow.  
It ensures clean communication between clients and the backend, enabling a structured real-time chat protocol when used alongside:
- `WsMessageType`
- `WsOutboundMessage`
- `WsChatController`
- `Message` + `MessageService`
