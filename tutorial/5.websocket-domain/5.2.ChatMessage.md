# 5.2. `ChatMessage`

`ChatMessage` is **WebSocket DTO** that represents a message exchanged between the frontend and backend through STOMP 
WebSocket communication.

It is not persisted in the database - it is a `transport-level object` used to send and receive chat events in real 
time.

```java
package com.chatapp.chat.chat;

import lombok.Data;
import lombok.NoArgsConstructor;

@Data
@NoArgsConstructor
public class ChatMessage {

    private String chatId;
    private String sender;
    private String content;
    private ChatMessageType type;

}
```

---

## ğŸ“ Purpose

The `ChatMessage`class is used as the **payload** for STOMP endpoints such as:
- `/app/chat.sendMessage`
- `/ap/chat.addUser`

and is forwarded to subscribers via:
- `/topic/chat.{chatId}`

It represents a message in transit, not stored in the database.

Persistence is handled separately by the `Message` JPA entity.

--- 

## ğŸ“Œ Fields Explained

### `chatId`

The identifier of the chat room.

Used to:
- determine which topic (`/topic/chat.{chatId}) the message should be broadcast to
- match the message to a specific conversation

---

### `sender`

The username (or ID) of the user sending the message.

Used by the frontend to:
- show who posted a message
- distinguish chat bubbles visually

---

### `content`

The raw text content of the message.

Only used when `type == CHAT`.
<br>
Ignored for system messages such as JOIN or LEAVE.

--- 

### `type`

A value from the `ChatMessageType` enum:
- `CHAT` - normal user message
- `JOIN` - user joined
- `LEAVE`- user left

Determines how the frontend should render the message.

--- 

## ğŸ“¡ Example JSON Payload

### Sent by frontend:

```java
{
  "chatId": "room123",
  "sender": "Alice",
  "content": "Hello!",
  "type": "CHAT"
}

```

### Sent by backend for join event:

```json
{
  "chatId": "room123",
  "sender": "bob",
  "type": "JOIN"
}
```

---

## ğŸ”„ How Backend Uses It

### In `ChatController.sendMessage`:
- Converts it to a JPA `Message` entity
- Saves it to database
- Broadcasts it back to subscribers

### In `ChatController.addUser`:
- Sets `type = JOIN`
- Broadcasts a system event

---

## ğŸ— Why This DTO Matters

**1. Decouples WebSocket communication from persistence.**<br>
The JPA `Message` entity stores database messages;
`ChatMessage` handles live WebSocket payloads.
<br>
**2. Clear, structured communication protocol.**<br>
Every WebSocket message follows the same format.
<br>
**3. Easily extendable.**<br>
For future fields like:
- timestamps
- read receipts
- typing indicators
- avatars
<br>
**4. Frontend-friendly.**<br>
Simple JSON structure, easy to parse.

---

## âœ” Summary
`ChatMessage` is the core WebSocket DTO for real-time chat communication.<br>
It carries chat events between clients and the server and works alongside `ChatMessageType` and `ChatController` to 
provide a clean, predictable messaging protocol.