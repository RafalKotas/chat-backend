# 6.1 `Chat` (JPA Entity)
`Chat` is the core JPA entity representing a **conversation space** inside the chat domain. It models two types of 
chats:
- **DIRECT** - one-to-one between exactly two users
- **GROUP** - multi-user chat rooms managed by participants

Each chat contains metadata such as type, name, timestamps, and a list of associated participants.

---

## ‚úî Class Definition

```
@Entity
@Getter
@Setter
@ToString
@NoArgsConstructor
@AllArgsConstructor
@Builder
@Table(name = "chats")
public class Chat {

    @Id
    @GeneratedValue
    private UUID id;

    @Enumerated(EnumType.STRING)
    @Column(nullable = false)
    private ChatType type;

    private String name;

    @OneToMany(mappedBy = "chat", cascade = CascadeType.ALL, orphanRemoval = true)
    private List<ChatParticipant> participants;

    @Column(nullable = false, updatable = false)
    private Instant createdAt = Instant.now();
}
```

---

## üìù Purpose

The `Chat` entity the **root of the chat aggregate:**
- defines the chat type (DIRECT/GROUP)
- contains human-readable name (for groups)
- holds the list of chat participants
- stores creation metadata
- is referenced by:
  - `ChatParticipant`
  - `Message`
  - `ChatService`
  - `ChatController`

It acts as the central entity that all other messaging-related models connect to.

---

## üìå Field-by-Field Explanation

---

### `id`

```java
@Id
@GeneratedValue
private UUID id;
```

- primary key of the chat
- automatically generated UUID
- used in all endpoints and topic subscriptions (`/topic/chat.{id}`)


---

### `type`

```java
@Enumerated(EnumType.STRING)
@Column(nullable = false)
private ChatType type;
```

Possible values:
- `DIRECT` - a 1-to-1 conversation
- `GROUP` - a multi-user group chat

Determines which operations are allowed, e.g.:
- only GROUP chats can add/remove participants
- DIRECT chats always contain exactly 2 users

---

### `name`

```java
private String name;
```

- Used only for **group chats**
- Can be displayed in the UI
- NULL for direct chats (they may later use autogenerated names like "Alice & Bob")

---

### `participants`

```java
@OneToMany(mappedBy = "chat", cascade = CascadeType.ALL, orphanRemoval = true)
private List<ChatParticipant> participants;
```

Represents users belonging to the chat.

**Notes:**
- **Bidirectional relationship**
    <br>Each `ChatParticipant` holds a reference back to the chat.
- **Cascade ALL**
    <br> Persist/Delete operations on `Chat` propagate to participants.
- **orphanRemoval = true**
    <br> Removing a participant from the collection will delete it from DB.
- Populated at runtime through `ChatService`

---

### `createdAt`

```java
@Column(nullable = false, updatable = false)
private Instant createdAt = Instant.now();
```

- automatically initialized timestamp of chat creation
- immutable
- useful for:
  - sorting chat lists
  - auditing
  - ordering conversations

---

## üîÑ Life Cycle Summary

### Direct chat

Created by:

```java
ChatService.createDirectChat()
```

Participants: always 2<br>
Name: null

---

### Group Chat

Created by:

```
ChatService.createGroupChat()
```

Participants:
- creator (ADMIN)
- users added later

Name: required from `CreateGroupChatRequest`

---

## üèó Example JSON Representation

(Usually returned by `ChatResponse`):

```java
{
  "id": "c8f923ef-d97c-4e1c-b076-25c93e41322f",
  "name": "Developers",
  "type": "GROUP",
  "participants": [
    { "userId": "b622c90f-55af-4cc0-a3af-d5c4509b3f1e", "role": "ADMIN" }
  ]
}
```

---

## ‚úî Summary

The `Chat` entity:
- represents the root of any conversation
- supports direct and group chat scenarios
- stores basic metadata (name, type, createdAt)
- manages its participants through a bidirectional relationship
- is persisted in the `chats` table
- is used by the REST and WebSocket layers to resolve chat context

It forms the backbone of the application's a messaging domain.
