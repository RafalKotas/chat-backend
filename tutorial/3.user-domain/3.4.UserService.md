# 3.4 UserService ‚Äî Domain Service (User Registration)

The `UserService` class represents the **domain-level business logic** related to users.

At this stage of the application, it focuses on **one core use case**:

> **User registration**

The service intentionally avoids acting as a thin wrapper around the repository.  
Instead, it encapsulates **domain rules and decisions**.

---

## üéØ Responsibility

`UserService` is responsible for:

- enforcing user-related business rules
- validating domain constraints (uniqueness)
- coordinating persistence operations
- throwing meaningful domain-specific exceptions

It does **not**:

- expose CRUD operations
- deal with HTTP or controllers
- manage authentication tokens
- handle password hashing (yet)

---

## üß© Class Overview

```java
@Service
public class UserService {

    private final UserRepository userRepository;

    public UserService(UserRepository userRepository) {
        this.userRepository = userRepository;
    }

    public User registerUser(User user) {
        ...
    }
}
```

### Dependency Injection
Dependencies are injected explicitly via constructor.
This avoids Lombok magic and keeps the class behavior transparent.

---

## üß† Implemented Business Logic
### 1Ô∏è‚É£ User Registration
#### Method Signature
```java
public User registerUser(User user)
```

#### Purpose
Registers a new user while enforcing all domain constraints.
This method represents a **business operation**, not a low-level database operation.

---
### üîÑ Registration Flow
#### 1. Validate email uniqueness
```java
if (userRepository.existsByEmail(user.getEmail())) {
    throw new EmailAlreadyUsedException(user.getEmail());
}
```
- Email is a globally unique identifier.
- Duplicate emails are rejected immediately.

---

#### 2. Validate username uniqueness (if provided)
```java
if (user.getUsername() != null &&
    userRepository.existsByUsername(user.getUsername())) {
    throw new UsernameAlreadyUsedException(user.getUsername());
}
```
- Username is optional.
- If present, it must be unique.
- Allows flexible identity setup (name-only or username-based).

---

#### 3. Persist user
```java
return userRepository.save(user);
```
- User is saved only after passing domain rules.
- Timestamps and UUID are handled automatically by JPA lifecycle hooks.

## ‚úî Business Guarantees
After successful execution:
- email is globally unique
- username is unique if present
- user is stored in valid state
- `createdAt` and `updatedAt` are initialized
- domain-specific exceptions indicate any failures

---

## ‚ùó Domain-Specific Exceptions
The service uses two custom exceptions:
- `EmailAlreadyUsedException`
- `UsernameAlreadyUsedException`

These exceptions:
- clearly express which domain rule was violated
- map naturally to HTTP **409 Conflict**
- are easy to test
- improve code readability

---

## üîê Password Handling (Planned)
Password hashing and validation will be added later during implementation of the **authentication module.**

This keeps:
- business logic (UserService) focused on domain rules
- security concerns isolated in their own module

---

## üß≠ Summary

`UserService` is a **use-case-oriented** domain service.

It:
- implements real business rules
- avoids exposing repository methods
- ensures correctness of user registration
- prepares the foundation for future authentication flows
- centralizes user-specific domain logic

Future responsibilities may include:
- updating user information
- changing email or username
- disabling accounts
- integrating  authentication and authorization

