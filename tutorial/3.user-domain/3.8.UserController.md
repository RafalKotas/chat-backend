# ğŸ“˜ 3.8. UserController

## Explaining the User Controller (REST API layer)

This document describes the purpose, structure, and design decisions behind the `UserController` in the **user-domain** 
module.

---

## ğŸ“ Location
```
src/main/java/com/chatapp/chat/user/controller/UserController.java
```

---

## ğŸ¯ Purpose of UserController

`UserController` is the **entry point** for HTTP requests related to user operations. In this stage of the project, it 
exposes one endpoint:

âœ” `POST /api/users/register`

Registers a new user using the data provided in the `UserRegistrationRequest`.

---

## ğŸ“¡ Endpoint Description

### POST /api/users/register

```java
@PostMapping("/register")
public UserResponse register(@RequestBody @Valid UserRegistrationRequest request) {
    User user = User.builder()
            .email(request.getEmail())
            .password(request.getPassword())
            .firstName(request.getFirstName())
            .lastName(request.getLastName())
            .username(request.getUsername())
            .build();

    User saved = userService.registerUser(user);

    return UserResponse.from(saved);
}
```

---

## ğŸ§  Flow Explanation (Step-by-step)
1. **Client sends JSON payload**
   
    The request body is automatically deserialized into `UserRegistrationRequest` using Spring's built-in JSON Mapper 
(Jackson). 
2. **Validation runs** (`@Valid`)
    
    All constraints defined in the DTO (email format, not null, length limits, etc.) are checked **before** entering 
the controller method.
3. **DTO â†’ Entity mapping using builder pattern**
    
    The controller converts the request DTO into a `User` domain entity via `User.builder()`. 

    This ensures immutability and prevents partial/inconsistent object creation.
4.  **Service handles business logic**
    
    `userService.registerUser(user)` performs the domain-level responsibilities:

    - checks **email uniqueness**
    - checks **username uniqueness** (if provided)
    - prepares timestamps
    - (later) hashes the password
    - persists the entity using `UserRepository`
5. **Entity â†’ Output DTO
    
    The saved `User` is transformed into a safe `UserResponse` using `UserResponse.from(saved)`, which exposes only 
non-sensitive fields.
6. **Controller returns `201 Created`**
    
    The API responds with a clean JSON structure containing the new user's public information.

---

## ğŸ§± Why Builder Instead of Setters?

Using the builder pattern in controller logic is deliberate.

### âœ… 1. Immutability at the input layer

We avoid mutable objects where possible.
DTO â†’ immutable `record`
Entity creation â†’ builder (single place, controlled construction)

### âœ… 2. Avoids partially initialized objects

Setters would allow:
```
User u = new User();
u.setEmail(...);
u.setPassword(...);
// oops, forgot username!
```
### âœ… 3. Clear mapping from DTO â†’ Entity
Using a builder expresses intent:
> "I want to create a complete `User` object on this request."

It acts as a clean boundary between API and domain model.

### âœ… 4. Helps with future extensibility

If we ever add:
- phone number
- avatar
- birthdate
- MFA setting

We only expand the builder - not modify controller logic using many setters.

###  ğŸ“ Summary:

**Builder = more readable, safer, less error-prone.**

Setters would encourage mutability and break the domain consistency.

---

## ğŸ”’ Why Not Expose the Entity Directly in Response?

Because entities contain:
- internal database IDs
- audit timestamps
- fields not meant for clients
- security-sensitive details (e.g. password hash)

`UserResponse` gives us control over **exactly what leaves the system.**

---

## ğŸ§­ Whatâ€™s Next?

Once `UserController` is merged, next steps are:
1. **feature/auth-registration**
   - password hashing
   - email confirmation (optional)
2. **feature/auth-login**
   - authenticate users
   - verify credentials
3. **feature/jwt**
   - generate JWT
   - create security filters

---
## ğŸ“¦ Files Created in This Step

```jupyter
tutorial/
   3.user-domain/
      3.8.UserController.md  â† THIS FILE
```