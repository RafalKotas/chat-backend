# 7. Testcontainers Integration

This project uses **Testcontainers** to run isolated PostgreSQL instances for integration tests. This ensures that
tests are reliable, reproducible, and completely independent from any local data.

---

## ğŸ“¦ 1. Requirements

To run tests with Testcontainers, you need:

- **Docker Desktop** installed and running
- **Java 21+**
- **Maven 3.9+**

Testcontainers will automatically start and clean up containers during the test lifecycle.

---

## ğŸ§ª 2. How Testcontainers Works in This Project

Integration tests automatically start a **PostgreSQL 16 container**
This is configured directly inside `ChatApplicationTests.java`:

```java
@Container
static PostgreSQLContainer<?> postgres =
        new PostgreSQLContainer<>("postgres:16")
                .withDatabaseName("testdb")
                .withUsername("test")
                .withPassword("test");

@DynamicPropertySource
static void props(DynamicPropertyRegistry registry) {
    registry.add("spring.datasource.url", postgres::getJdbcUrl);
    registry.add("spring.datasource.username", postgres::getUsername);
    registry.add("spring.datasource.password", postgres::getPassword);
}
```
### What this means:
- Before tests start, Docker launches a PostgreSQL container
- Spring Boot automatically uses this dynamic datasource
- After tests finish, the container is removed
- Your real database is never touched

---

## â–¶ï¸ 3. Running Tests

Run all tests with:

```powershell
mvn clean test
```

Maven will:
1. Pull PostgreSQL if necessary
2. Start the Testcontainers-managed database
3. Execute tests
4. Stop and clean up containers

---

## ğŸ“ 4. Notes
- Each test run uses a **fresh database instance*
- You do not need any local PostgreSQL installed
- If tests fail early, make sure Docker Desktop is running
- Testcontainers works on Windows, macOS, and Linux

---

## ğŸ§¹ 5. Troubleshooting

### "Docker environment not found"

Start Docker Desktop manually.

### "Connection refused" during tests

Your Docker may need a restart.

### Slow container startup

First startup is slow because PostgreSQL image is being downloaded.

---

## ğŸ“š 6. Useful Links
- Testcontainers docs: http://www.testcontainers.org/
- PostgreSQL module: https://www.testcontainers.org/modules/databases/postgres/

Testcontainers ensures fully isolated integration testing - no shared state, no manual database setup, and consistent
behavior across all machines.

---
